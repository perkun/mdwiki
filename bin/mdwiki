#!/bin/python
# created by perkun on 05/07/2021

from jinja2 import Environment, FileSystemLoader
import shutil
import os
import argparse

from libmdwiki.utils import mkdir, rmdir
from libmdwiki.Site import Site


# TODO move this to configuration or something
TEMPLATES_DIR = '/home/perkun/wiki/templates'

parser = argparse.ArgumentParser()
parser.add_argument("file", help="vimwiki file")
parser.add_argument("--outdir",  required=True, help="output directory")
parser.add_argument("--url",  required=True, help="base site url")
parser.add_argument("--name",  required=True, help="name of the wiki")
args = parser.parse_args()


# templates
file_loader = FileSystemLoader(TEMPLATES_DIR)
env = Environment(loader=file_loader)
# env.add_extension(MarkdownExtension)


rmdir(args.outdir)
mkdir(args.outdir)

if not os.path.exists(args.outdir + "/static"):
    shutil.copytree(TEMPLATES_DIR + "/static", args.outdir + "/static")


if os.path.dirname(args.file) != '':
    os.chdir(os.path.dirname(args.file))


site = Site(args.url, args.outdir, args.name)
site.generate(os.path.basename(args.file), env)
